# üéØ Guide Complet E2E Testing avec Playwright - CV Genius

## üìö Table des Mati√®res

1. [Qu'est-ce que le E2E Testing ?](#quest-ce-que-le-e2e-testing-)
2. [Pourquoi Playwright ?](#pourquoi-playwright-)
3. [Architecture des Tests E2E](#architecture-des-tests-e2e)
4. [Configuration et Setup](#configuration-et-setup)
5. [Concepts Fondamentaux](#concepts-fondamentaux)
6. [Patterns et Bonnes Pratiques](#patterns-et-bonnes-pratiques)
7. [Tests Pratiques pour CV-Genius](#tests-pratiques-pour-cv-genius)
8. [Debugging et Maintenance](#debugging-et-maintenance)
9. [CI/CD et Automatisation](#cicd-et-automatisation)

---

## Qu'est-ce que le E2E Testing ? ü§î

### D√©finition
Les **tests End-to-End (E2E)** simulent le comportement d'un utilisateur r√©el qui navigue dans votre application. Contrairement aux tests unitaires qui testent des fonctions isol√©es, ou aux tests d'int√©gration qui testent des interactions entre composants, les tests E2E v√©rifient que **l'application enti√®re fonctionne correctement** du point de vue de l'utilisateur final.

### Pyramide des Tests
```
        /\
       /  \
      / E2E \     ‚Üê Moins nombreux, plus lents, plus co√ªteux
     /______\       Mais testent l'exp√©rience utilisateur compl√®te
    /        \
   / INT√âGR. \    ‚Üê Tests d'interaction entre modules
  /__________\
 /            \
/ UNITAIRES   \   ‚Üê Nombreux, rapides, cibl√©s
/______________\     Testent la logique m√©tier isol√©e
```

### Diff√©rence avec les autres types de tests

#### ‚ùå Test Unitaire
```javascript
// Teste UNE fonction isol√©e
test('validateEmail should return true for valid email', () => {
  expect(validateEmail('test@example.com')).toBe(true);
});
```

#### ‚ùå Test d'Int√©gration  
```javascript
// Teste l'interaction entre composants (avec mocks)
test('LoginForm should call authentication service', () => {
  const mockAuth = jest.fn();
  render(<LoginForm authService={mockAuth} />);
  // ... teste l'interaction sans vraie API
});
```

#### ‚úÖ Test E2E
```javascript
// Teste le parcours utilisateur COMPLET avec la vraie application
test('User can login and access dashboard', async ({ page }) => {
  await page.goto('/login');
  await page.fill('[data-testid="email"]', 'user@example.com');
  await page.fill('[data-testid="password"]', 'password123');
  await page.click('button[type="submit"]');
  await expect(page).toHaveURL('/dashboard');
  await expect(page.locator('h1')).toContainText('Tableau de bord');
});
```

### Quand utiliser les tests E2E ?

#### ‚úÖ Parfait pour :
- **Parcours utilisateur critiques** (inscription, connexion, achat)
- **Fonctionnalit√©s m√©tier importantes** (g√©n√©ration de CV, paiement)
- **Int√©grations complexes** (API externes, bases de donn√©es)
- **Validation avant d√©ploiement** (smoke tests)

#### ‚ùå √âviter pour :
- **Logique m√©tier complexe** ‚Üí Tests unitaires
- **Validation de formulaires simples** ‚Üí Tests d'int√©gration
- **Tests de performance** ‚Üí Outils sp√©cialis√©s
- **Cas d'erreur edge cases** ‚Üí Tests unitaires

---

## Pourquoi Playwright ? üé≠

### Avantages de Playwright

#### üöÄ **Multi-navigateurs natif**
```javascript
// Un seul test, tous les navigateurs
export default defineConfig({
  projects: [
    { name: 'chromium', use: { ...devices['Desktop Chrome'] } },
    { name: 'firefox', use: { ...devices['Desktop Firefox'] } },
    { name: 'webkit', use: { ...devices['Desktop Safari'] } },
    { name: 'mobile', use: { ...devices['iPhone 12'] } },
  ],
});
```

#### ‚ö° **Performance exceptionnelle**
- **Parall√©lisation automatique** des tests
- **Auto-waiting** intelligent (pas de `sleep()` manuels)
- **Retry automatique** sur √©chec

#### üõ†Ô∏è **Outils de d√©veloppement int√©gr√©s**
- **Playwright Inspector** pour d√©bugger en mode step-by-step
- **Trace Viewer** pour analyser les √©checs
- **Codegen** pour g√©n√©rer automatiquement les tests

#### üì± **Support mobile et responsive**
```javascript
// Tester sur mobile
test('should work on mobile', async ({ page }) => {
  await page.setViewportSize({ width: 375, height: 667 });
  // ... tests mobile
});
```

### Comparaison avec les alternatives

| Outil | Avantages | Inconv√©nients |
|-------|-----------|---------------|
| **Playwright** | Multi-navigateurs, rapide, outils excellents | Plus r√©cent |
| **Cypress** | Interface graphique, DX excellent | Chrome uniquement, limitations iframe |
| **Selenium** | Mature, langages multiples | Lent, configuration complexe |
| **Puppeteer** | Rapide pour Chrome | Chrome uniquement |

---

## Architecture des Tests E2E üèóÔ∏è

### Structure recommand√©e

```
tests/
‚îú‚îÄ‚îÄ e2e/                          # Tests end-to-end
‚îÇ   ‚îú‚îÄ‚îÄ auth/                     # Tests d'authentification
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ login.spec.ts         # Connexion utilisateur
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ register.spec.ts      # Inscription utilisateur  
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ logout.spec.ts        # D√©connexion
‚îÇ   ‚îú‚îÄ‚îÄ dashboard/                # Tests du tableau de bord
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ cv-upload.spec.ts     # Upload de CV
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ cv-form.spec.ts       # Formulaires CV
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ cv-generation.spec.ts # G√©n√©ration avec IA
‚îÇ   ‚îú‚îÄ‚îÄ navigation/               # Tests de navigation
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ header.spec.ts        # Navigation principale
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ routing.spec.ts       # Routing entre pages
‚îÇ   ‚îî‚îÄ‚îÄ smoke/                    # Tests de fum√©e (critiques)
‚îÇ       ‚îî‚îÄ‚îÄ critical-path.spec.ts # Parcours principal
‚îú‚îÄ‚îÄ fixtures/                     # Donn√©es de test
‚îÇ   ‚îú‚îÄ‚îÄ users.json               # Utilisateurs de test
‚îÇ   ‚îî‚îÄ‚îÄ cv-data.json             # Donn√©es CV de test
‚îú‚îÄ‚îÄ pages/                        # Page Object Model
‚îÇ   ‚îú‚îÄ‚îÄ LoginPage.ts             # Abstraction page login
‚îÇ   ‚îú‚îÄ‚îÄ DashboardPage.ts         # Abstraction page dashboard
‚îÇ   ‚îî‚îÄ‚îÄ BasePage.ts              # M√©thodes communes
‚îî‚îÄ‚îÄ utils/                        # Utilitaires de test
    ‚îú‚îÄ‚îÄ test-data.ts             # G√©n√©ration de donn√©es
    ‚îî‚îÄ‚îÄ helpers.ts               # Fonctions d'aide
```

### Page Object Model (POM)

Le **Page Object Model** est un pattern qui encapsule les √©l√©ments et actions d'une page dans une classe, rendant les tests plus maintenables.

#### ‚ùå Sans POM (difficile √† maintenir)
```javascript
test('user can login', async ({ page }) => {
  await page.goto('/login');
  await page.fill('#email', 'user@example.com');
  await page.fill('#password', 'password123');
  await page.click('button[type="submit"]');
  await expect(page.locator('h1')).toContainText('Dashboard');
});

test('login with invalid credentials', async ({ page }) => {
  await page.goto('/login');
  await page.fill('#email', 'invalid@example.com');
  await page.fill('#password', 'wrongpass');
  await page.click('button[type="submit"]');
  await expect(page.locator('.error')).toBeVisible();
});
```

#### ‚úÖ Avec POM (maintenable et r√©utilisable)
```javascript
// pages/LoginPage.ts
export class LoginPage {
  constructor(private page: Page) {}

  // S√©lecteurs centralis√©s
  private selectors = {
    emailInput: '[data-testid="email-input"]',
    passwordInput: '[data-testid="password-input"]',
    submitButton: '[data-testid="submit-button"]',
    errorMessage: '[role="alert"]',
    form: '[data-testid="login-form"]'
  };

  // Actions de haut niveau
  async goto() {
    await this.page.goto('/login');
    await this.waitForPageLoad();
  }

  async login(email: string, password: string) {
    await this.fillEmail(email);
    await this.fillPassword(password);
    await this.submit();
  }

  async fillEmail(email: string) {
    await this.page.fill(this.selectors.emailInput, email);
  }

  async fillPassword(password: string) {
    await this.page.fill(this.selectors.passwordInput, password);
  }

  async submit() {
    await this.page.click(this.selectors.submitButton);
  }

  // V√©rifications
  async expectErrorMessage(message: string) {
    await expect(this.page.locator(this.selectors.errorMessage))
      .toContainText(message);
  }

  async expectLoginSuccess() {
    await expect(this.page).toHaveURL('/dashboard');
  }

  private async waitForPageLoad() {
    await expect(this.page.locator(this.selectors.form)).toBeVisible();
  }
}

// tests/e2e/auth/login.spec.ts
test('user can login with valid credentials', async ({ page }) => {
  const loginPage = new LoginPage(page);
  
  await loginPage.goto();
  await loginPage.login('user@example.com', 'password123');
  await loginPage.expectLoginSuccess();
});
```

---

## Configuration et Setup ‚öôÔ∏è

### Configuration actuelle dans votre projet

Votre projet a d√©j√† une configuration Playwright solide dans `playwright.config.ts` :

```typescript
export default defineConfig({
  testDir: './tests/e2e',           // Dossier des tests E2E
  fullyParallel: true,              // Tests en parall√®le
  retries: process.env.CI ? 2 : 0,  // Retry en CI
  reporter: 'html',                 // Rapport HTML
  
  use: {
    baseURL: 'http://localhost:3000',  // URL de base
    trace: 'on-first-retry',          // Traces pour debug
    screenshot: 'only-on-failure',    // Screenshots d'√©chec
  },

  projects: [
    { name: 'chromium', use: { ...devices['Desktop Chrome'] } },
    { name: 'firefox', use: { ...devices['Desktop Firefox'] } },
    { name: 'webkit', use: { ...devices['Desktop Safari'] } },
    { name: 'Mobile Chrome', use: { ...devices['Pixel 5'] } },
    { name: 'Mobile Safari', use: { ...devices['iPhone 12'] } },
  ],

  webServer: {
    command: 'npm run dev',           // Lance le serveur automatiquement
    url: 'http://localhost:3000',
    reuseExistingServer: !process.env.CI,
  },
});
```

### Variables d'environnement pour les tests

Cr√©ez un fichier `.env.test` pour les tests :

```env
# Variables sp√©cifiques aux tests E2E
NEXT_PUBLIC_SUPABASE_URL=http://localhost:54321
NEXT_PUBLIC_SUPABASE_ANON_KEY=test_anon_key
GEMINI_API_KEY=test_gemini_key
NEXTAUTH_URL=http://localhost:3000

# Utilisateurs de test
TEST_USER_EMAIL=test@example.com
TEST_USER_PASSWORD=TestPassword123
```

### Scripts package.json

Ajoutez ces scripts √† votre `package.json` :

```json
{
  "scripts": {
    "test:e2e": "playwright test",
    "test:e2e:ui": "playwright test --ui",
    "test:e2e:debug": "playwright test --debug",
    "test:e2e:headed": "playwright test --headed",
    "test:e2e:report": "playwright show-report"
  }
}
```

---

## Concepts Fondamentaux üß†

### 1. Locators (S√©lecteurs)

Les **locators** sont la fa√ßon dont Playwright trouve les √©l√©ments dans la page.

#### Types de locators

```javascript
// ‚úÖ Par data-testid (RECOMMAND√â)
await page.locator('[data-testid="submit-button"]').click();

// ‚úÖ Par role (accessible)
await page.locator('button', { hasText: 'Se connecter' }).click();

// ‚úÖ Par texte
await page.locator('text=Se connecter').click();

// ‚ö†Ô∏è Par classe CSS (fragile)
await page.locator('.btn-primary').click();

// ‚ùå Par XPath (complexe et fragile)
await page.locator('//button[@class="btn-primary"]').click();
```

#### Locators cha√Æn√©s et filtr√©s

```javascript
// Trouver un bouton dans un formulaire sp√©cifique
await page
  .locator('[data-testid="login-form"]')
  .locator('button[type="submit"]')
  .click();

// Filtrer par texte
await page
  .locator('button')
  .filter({ hasText: 'Confirmer' })
  .click();

// Premier/dernier √©l√©ment
await page.locator('.item').first().click();
await page.locator('.item').last().click();
await page.locator('.item').nth(2).click();
```

### 2. Actions

#### Actions de base

```javascript
// Navigation
await page.goto('/dashboard');
await page.goBack();
await page.reload();

// Saisie de texte
await page.fill('[data-testid="email"]', 'user@example.com');
await page.type('[data-testid="password"]', 'password', { delay: 100 });

// Clics
await page.click('button');
await page.dblclick('button');
await page.hover('button');

// S√©lection
await page.selectOption('select', 'option-value');
await page.check('input[type="checkbox"]');
await page.setChecked('input[type="checkbox"]', true);

// Upload de fichier
await page.setInputFiles('input[type="file"]', 'path/to/file.pdf');

// Glisser-d√©poser
await page.dragAndDrop('[data-testid="source"]', '[data-testid="target"]');
```

#### Actions avanc√©es

```javascript
// Attendre qu'un √©l√©ment soit visible
await page.waitForSelector('[data-testid="result"]');

// Attendre une navigation
await page.waitForURL('**/dashboard');

// Attendre une r√©ponse API
await page.waitForResponse('**/api/cv/generate');

// Ex√©cuter JavaScript dans la page
const title = await page.evaluate(() => document.title);

// Prendre une screenshot
await page.screenshot({ path: 'example.png', fullPage: true });
```

### 3. Assertions

Playwright utilise `expect` pour les v√©rifications :

```javascript
// V√©rifications d'√©l√©ments
await expect(page.locator('h1')).toBeVisible();
await expect(page.locator('h1')).toContainText('Bienvenue');
await expect(page.locator('input')).toHaveValue('test@example.com');
await expect(page.locator('button')).toBeDisabled();

// V√©rifications de page
await expect(page).toHaveURL('/dashboard');
await expect(page).toHaveTitle(/CV Genius/);

// V√©rifications de comptage: There is exactly 3 elements that has the CSS class cv-item
await expect(page.locator('.cv-item')).toHaveCount(3);

// V√©rifications avec timeout personnalis√©: The loading sign to be disappear after 10000ms (=10s)
await expect(page.locator('.loading')).toBeHidden({ timeout: 10000 });
```

### 4. Auto-waiting

**Playwright attend automatiquement** que les √©l√©ments soient pr√™ts :

```javascript
// ‚úÖ Pas besoin de wait manuel
await page.click('button'); // Attend que le bouton soit cliquable

// ‚úÖ Pas besoin de wait pour les r√©ponses API
await page.fill('input', 'text'); // Attend que l'input soit disponible

// ‚ùå √âviter les waits manuels (sauf cas sp√©ciaux)
await page.waitForTimeout(5000); // Anti-pattern !
```

---

## Patterns et Bonnes Pratiques üìã

### 1. Data-testid Strategy

#### ‚úÖ Bonnes pratiques

```javascript
// Ajoutez des data-testid dans vos composants
const LoginForm = () => (
  <form data-testid="login-form">
    <input 
      data-testid="email-input"
      type="email" 
    />
    <input 
      data-testid="password-input"
      type="password" 
    />
    <button 
      data-testid="submit-button"
      type="submit"
    >
      Se connecter
    </button>
  </form>
);

// Utilisez-les dans les tests
await page.fill('[data-testid="email-input"]', 'user@example.com');
await page.click('[data-testid="submit-button"]');
```

#### Convention de nommage

```typescript
// Convention : [component]-[element]-[action?]
data-testid="login-form"
data-testid="email-input"
data-testid="submit-button"
data-testid="error-message"
data-testid="cv-upload-zone"
data-testid="experience-add-button"
data-testid="skill-remove-button"
```

### 2. Gestion des donn√©es de test

#### Fixtures pour les donn√©es

```typescript
// tests/fixtures/test-data.ts
export const testUsers = {
  validUser: {
    email: 'valid@example.com',
    password: 'ValidPassword123',
    name: 'Jean Dupont'
  },
  invalidUser: {
    email: 'invalid@example.com',
    password: 'wrongpassword'
  }
};

export const testCVData = {
  basicCV: {
    personalInfo: {
      name: 'Jean Dupont',
      email: 'jean@example.com',
      phone: '01.23.45.67.89',
      location: 'Paris, France'
    },
    experiences: [
      {
        company: 'Tech Corp',
        position: 'D√©veloppeur Full Stack',
        duration: '2020-2023',
        description: 'D√©veloppement d\'applications web modernes'
      }
    ]
  }
};
```

#### Utilisation dans les tests

```typescript
import { testUsers, testCVData } from '../fixtures/test-data';

test('user can create CV with valid data', async ({ page }) => {
  const loginPage = new LoginPage(page);
  const dashboardPage = new DashboardPage(page);
  
  await loginPage.goto();
  await loginPage.login(testUsers.validUser.email, testUsers.validUser.password);
  
  await dashboardPage.fillCVForm(testCVData.basicCV);
  await dashboardPage.submitCV();
  
  await expect(page.locator('[data-testid="success-message"]')).toBeVisible();
});
```

### 3. Setup et teardown

#### Hooks de test

```typescript
import { test as base, expect } from '@playwright/test';

// Extended test avec setup automatique
export const test = base.extend({
  authenticatedPage: async ({ page }, use) => {
    // Setup : connexion automatique
    await page.goto('/login');
    await page.fill('[data-testid="email-input"]', process.env.TEST_USER_EMAIL);
    await page.fill('[data-testid="password-input"]', process.env.TEST_USER_PASSWORD);
    await page.click('[data-testid="submit-button"]');
    await expect(page).toHaveURL('/dashboard');
    
    // Utilisation dans le test
    await use(page);
    
    // Teardown : nettoyage si n√©cessaire
    // await cleanupTestData();
  }
});

// Utilisation
test('authenticated user can access dashboard', async ({ authenticatedPage }) => {
  // L'utilisateur est d√©j√† connect√© !
  await expect(authenticatedPage.locator('h1')).toContainText('Tableau de bord');
});
```

### 4. Gestion des states

#### Storage state (session persistante)

```typescript
// playwright.config.ts
export default defineConfig({
  projects: [
    // Setup pour cr√©er l'√©tat d'authentification
    {
      name: 'setup',
      testMatch: /.*\.setup\.ts/,
    },
    // Tests qui utilisent l'√©tat d'authentification
    {
      name: 'authenticated tests',
      use: { storageState: 'tests/.auth/user.json' },
      dependencies: ['setup'],
    },
  ],
});

// tests/auth.setup.ts
test('authenticate user', async ({ page }) => {
  await page.goto('/login');
  await page.fill('[data-testid="email-input"]', process.env.TEST_USER_EMAIL);
  await page.fill('[data-testid="password-input"]', process.env.TEST_USER_PASSWORD);
  await page.click('[data-testid="submit-button"]');
  
  await expect(page).toHaveURL('/dashboard');
  
  // Sauvegarder l'√©tat d'authentification
  await page.context().storageState({ path: 'tests/.auth/user.json' });
});
```

---

## Tests Pratiques pour CV-Genius üè†

Maintenant, cr√©ons des tests E2E concrets pour votre application CV-Genius :

### 1. Test de Connexion Utilisateur

```typescript
// tests/e2e/auth/login.spec.ts
import { test, expect } from '@playwright/test';

test.describe('Login Flow', () => {
  test.beforeEach(async ({ page }) => {
    // Aller √† la page de connexion avant chaque test
    await page.goto('/login');
  });

  test('should login with valid credentials', async ({ page }) => {
    // üéØ OBJECTIF: V√©rifier qu'un utilisateur peut se connecter avec des identifiants valides
    
    // ‚úÖ √âTAPE 1: V√©rifier que la page de connexion s'affiche correctement
    await expect(page.locator('[data-testid="login-form"]')).toBeVisible();
    await expect(page.locator('h1')).toContainText('Connexion');
    
    // ‚úÖ √âTAPE 2: Remplir le formulaire de connexion
    await page.fill('[data-testid="email-input"]', 'test@example.com');
    await page.fill('[data-testid="password-input"]', 'ValidPassword123');
    
    // ‚úÖ √âTAPE 3: V√©rifier que les valeurs sont bien saisies
    await expect(page.locator('[data-testid="email-input"]')).toHaveValue('test@example.com');
    await expect(page.locator('[data-testid="password-input"]')).toHaveValue('ValidPassword123');
    
    // ‚úÖ √âTAPE 4: Soumettre le formulaire
    await page.click('[data-testid="submit-button"]');
    
    // ‚úÖ √âTAPE 5: V√©rifier l'√©tat de chargement
    await expect(page.locator('[data-testid="submit-button"]')).toBeDisabled();
    await expect(page.locator('[data-testid="submit-button"]')).toContainText('Connexion...');
    
    // ‚úÖ √âTAPE 6: Attendre la redirection vers le dashboard
    await expect(page).toHaveURL('/dashboard');
    
    // ‚úÖ √âTAPE 7: V√©rifier que l'utilisateur est bien sur le dashboard
    await expect(page.locator('h1')).toContainText('Tableau de bord');
  });

  test('should show error with invalid credentials', async ({ page }) => {
    // üéØ OBJECTIF: V√©rifier la gestion d'erreur pour des identifiants invalides
    
    await page.fill('[data-testid="email-input"]', 'invalid@example.com');
    await page.fill('[data-testid="password-input"]', 'wrongpassword');
    await page.click('[data-testid="submit-button"]');
    
    // ‚úÖ V√©rifier l'affichage du message d'erreur
    await expect(page.locator('[role="alert"]')).toBeVisible();
    await expect(page.locator('[role="alert"]')).toContainText('Email ou mot de passe incorrect');
    
    // ‚úÖ V√©rifier que l'utilisateur reste sur la page de connexion
    await expect(page).toHaveURL('/login');
  });

  test('should validate required fields', async ({ page }) => {
    // üéØ OBJECTIF: V√©rifier la validation c√¥t√© client
    
    // Tenter de soumettre sans rien remplir
    await page.click('[data-testid="submit-button"]');
    
    // Les champs email et password sont "required" en HTML5
    // Le navigateur emp√™che la soumission
    await expect(page).toHaveURL('/login'); // Reste sur la page
  });
});
```

### 2. Test du Workflow CV Complet

```typescript
// tests/e2e/dashboard/cv-workflow.spec.ts
import { test, expect } from '@playwright/test';

test.describe('CV Creation Workflow', () => {
  // Setup: Connexion automatique avant chaque test
  test.beforeEach(async ({ page }) => {
    await page.goto('/login');
    await page.fill('[data-testid="email-input"]', 'test@example.com');
    await page.fill('[data-testid="password-input"]', 'ValidPassword123');
    await page.click('[data-testid="submit-button"]');
    await expect(page).toHaveURL('/dashboard');
  });

  test('should create CV from manual data entry', async ({ page }) => {
    // üéØ OBJECTIF: Tester la cr√©ation compl√®te d'un CV en saisissant les donn√©es manuellement
    
    // ‚úÖ √âTAPE 1: V√©rifier l'affichage initial du dashboard
    await expect(page.locator('h1')).toContainText('Tableau de bord');
    await expect(page.locator('[data-testid="cv-form"]')).toBeVisible();
    
    // ‚úÖ √âTAPE 2: Remplir les informations personnelles
    await page.fill('[data-testid="name-input"]', 'Jean Dupont');
    await page.fill('[data-testid="email-input"]', 'jean.dupont@example.com');
    await page.fill('[data-testid="phone-input"]', '01.23.45.67.89');
    await page.fill('[data-testid="location-input"]', 'Paris, France');
    
    // ‚úÖ √âTAPE 3: Ajouter une exp√©rience professionnelle
    await page.click('[data-testid="add-experience-button"]');
    
    // Remplir la premi√®re exp√©rience
    await page.fill('[data-testid="experience-0-company"]', 'Tech Solutions');
    await page.fill('[data-testid="experience-0-position"]', 'D√©veloppeur Full Stack');
    await page.fill('[data-testid="experience-0-duration"]', '2020-2023');
    await page.fill('[data-testid="experience-0-description"]', 
      'D√©veloppement d\'applications web avec React et Node.js');
    
    // ‚úÖ √âTAPE 4: Ajouter une formation
    await page.click('[data-testid="add-education-button"]');
    await page.fill('[data-testid="education-0-school"]', 'Universit√© de Paris');
    await page.fill('[data-testid="education-0-degree"]', 'Master Informatique');
    await page.fill('[data-testid="education-0-year"]', '2018-2020');
    
    // ‚úÖ √âTAPE 5: Ajouter des comp√©tences
    await page.click('[data-testid="add-skill-button"]');
    await page.fill('[data-testid="skill-0-name"]', 'JavaScript');
    await page.selectOption('[data-testid="skill-0-level"]', 'Avanc√©');
    
    await page.click('[data-testid="add-skill-button"]');
    await page.fill('[data-testid="skill-1-name"]', 'React');
    await page.selectOption('[data-testid="skill-1-level"]', 'Avanc√©');
    
    // ‚úÖ √âTAPE 6: Ajouter des langues
    await page.click('[data-testid="add-language-button"]');
    await page.fill('[data-testid="language-0-name"]', 'Fran√ßais');
    await page.selectOption('[data-testid="language-0-level"]', 'Natif');
    
    // ‚úÖ √âTAPE 7: G√©n√©rer le CV avec l'IA
    await page.click('[data-testid="generate-cv-button"]');
    
    // ‚úÖ √âTAPE 8: V√©rifier l'ouverture du modal de g√©n√©ration
    await expect(page.locator('[data-testid="generation-modal"]')).toBeVisible();
    await expect(page.locator('text=G√©n√©ration en cours')).toBeVisible();
    
    // ‚úÖ √âTAPE 9: V√©rifier les √©tapes de progression
    await expect(page.locator('[data-testid="step-validation"]')).toContainText('Validation');
    await expect(page.locator('[data-testid="step-ai-improvement"]')).toContainText('Am√©lioration IA');
    
    // ‚úÖ √âTAPE 10: Attendre la fin de la g√©n√©ration (timeout g√©n√©reux pour l'IA)
    await expect(page.locator('[data-testid="generation-success"]')).toBeVisible({ timeout: 30000 });
    
    // ‚úÖ √âTAPE 11: V√©rifier que le PDF est g√©n√©r√© (download automatique)
    const downloadPromise = page.waitForEvent('download');
    await downloadPromise;
    
    // ‚úÖ √âTAPE 12: Fermer le modal
    await page.click('[data-testid="close-modal-button"]');
    await expect(page.locator('[data-testid="generation-modal"]')).toBeHidden();
  });

  test('should upload and parse PDF CV', async ({ page }) => {
    // üéØ OBJECTIF: Tester l'upload et le parsing d'un CV PDF existant
    
    // ‚úÖ √âTAPE 1: V√©rifier la zone d'upload
    await expect(page.locator('[data-testid="file-upload-zone"]')).toBeVisible();
    
    // ‚úÖ √âTAPE 2: Simuler l'upload d'un fichier PDF
    // Note: Vous devez avoir un fichier de test dans tests/fixtures/
    const fileInput = page.locator('input[type="file"]');
    await fileInput.setInputFiles('tests/fixtures/sample-cv.pdf');
    
    // ‚úÖ √âTAPE 3: V√©rifier que le fichier est upload√©
    await expect(page.locator('[data-testid="uploaded-file-name"]')).toContainText('sample-cv.pdf');
    
    // ‚úÖ √âTAPE 4: Attendre le parsing automatique
    await expect(page.locator('[data-testid="parsing-progress"]')).toBeVisible();
    await expect(page.locator('[data-testid="parsing-complete"]')).toBeVisible({ timeout: 15000 });
    
    // ‚úÖ √âTAPE 5: V√©rifier que les donn√©es sont pr√©-remplies
    await expect(page.locator('[data-testid="name-input"]')).not.toHaveValue('');
    await expect(page.locator('[data-testid="email-input"]')).not.toHaveValue('');
    
    // ‚úÖ √âTAPE 6: V√©rifier qu'au moins une exp√©rience est ajout√©e
    await expect(page.locator('[data-testid="experience-0-company"]')).toBeVisible();
  });

  test('should handle errors gracefully', async ({ page }) => {
    // üéØ OBJECTIF: V√©rifier la gestion d'erreur
    
    // Tenter de g√©n√©rer un CV sans donn√©es minimales
    await page.click('[data-testid="generate-cv-button"]');
    
    // V√©rifier l'affichage du toast d'erreur
    await expect(page.locator('[data-testid="error-toast"]')).toBeVisible();
    await expect(page.locator('[data-testid="error-toast"]')).toContainText('Nom et email requis');
  });
});
```

### 3. Test de Navigation et Header

```typescript
// tests/e2e/navigation/header.spec.ts
import { test, expect } from '@playwright/test';

test.describe('Header Navigation', () => {
  test('should navigate correctly when not authenticated', async ({ page }) => {
    // üéØ OBJECTIF: Tester la navigation pour un utilisateur non connect√©
    
    await page.goto('/');
    
    // ‚úÖ V√©rifier les liens pr√©sents
    await expect(page.locator('[data-testid="login-link"]')).toBeVisible();
    await expect(page.locator('[data-testid="register-link"]')).toBeVisible();
    
    // ‚úÖ Tester navigation vers login
    await page.click('[data-testid="login-link"]');
    await expect(page).toHaveURL('/login');
    
    // ‚úÖ Retourner √† l'accueil et tester navigation vers register
    await page.goto('/');
    await page.click('[data-testid="register-link"]');
    await expect(page).toHaveURL('/register');
  });

  test('should show user menu when authenticated', async ({ page }) => {
    // üéØ OBJECTIF: Tester la navigation pour un utilisateur connect√©
    
    // Connexion
    await page.goto('/login');
    await page.fill('[data-testid="email-input"]', 'test@example.com');
    await page.fill('[data-testid="password-input"]', 'ValidPassword123');
    await page.click('[data-testid="submit-button"]');
    await expect(page).toHaveURL('/dashboard');
    
    // ‚úÖ V√©rifier le menu utilisateur
    await expect(page.locator('[data-testid="user-menu"]')).toBeVisible();
    await expect(page.locator('[data-testid="dashboard-link"]')).toBeVisible();
    await expect(page.locator('[data-testid="logout-button"]')).toBeVisible();
    
    // ‚úÖ Tester la d√©connexion
    await page.click('[data-testid="logout-button"]');
    await expect(page).toHaveURL('/');
    await expect(page.locator('[data-testid="login-link"]')).toBeVisible();
  });
});
```

### 4. Tests de R√©gression (Smoke Tests)

```typescript
// tests/e2e/smoke/critical-paths.spec.ts
import { test, expect } from '@playwright/test';

test.describe('Smoke Tests - Critical Paths', () => {
  test('complete user journey from registration to CV generation', async ({ page }) => {
    // üéØ OBJECTIF: Test de bout en bout du parcours utilisateur critique
    
    // ‚úÖ √âTAPE 1: Inscription
    await page.goto('/register');
    
    const timestamp = Date.now();
    const testEmail = `test${timestamp}@example.com`;
    
    await page.fill('[data-testid="email-input"]', testEmail);
    await page.fill('[data-testid="password-input"]', 'TestPassword123');
    await page.fill('[data-testid="confirm-password-input"]', 'TestPassword123');
    await page.click('[data-testid="submit-button"]');
    
    // ‚úÖ √âTAPE 2: V√©rification de l'inscription
    await expect(page).toHaveURL('/dashboard');
    
    // ‚úÖ √âTAPE 3: Cr√©ation rapide d'un CV
    await page.fill('[data-testid="name-input"]', 'Test User');
    await page.fill('[data-testid="email-input"]', testEmail);
    
    // ‚úÖ √âTAPE 4: G√©n√©ration du CV
    await page.click('[data-testid="generate-cv-button"]');
    await expect(page.locator('[data-testid="generation-modal"]')).toBeVisible();
    
    // ‚úÖ √âTAPE 5: Attendre le succ√®s (timeout g√©n√©reux)
    await expect(page.locator('[data-testid="generation-success"]')).toBeVisible({ timeout: 30000 });
  });

  test('all critical pages load correctly', async ({ page }) => {
    // üéØ OBJECTIF: V√©rifier que toutes les pages critiques se chargent
    
    const criticalPages = ['/', '/login', '/register'];
    
    for (const pagePath of criticalPages) {
      await page.goto(pagePath);
      
      // V√©rifier qu'il n'y a pas d'erreur JavaScript
      page.on('pageerror', (error) => {
        throw new Error(`Page error on ${pagePath}: ${error.message}`);
      });
      
      // V√©rifier que la page se charge (pas d'erreur 404/500)
      expect(page.url()).toContain(pagePath);
    }
  });
});
```

---

## Debugging et Maintenance üîß

### 1. Outils de Debug

#### Playwright Inspector
```bash
# Lancer en mode debug
npm run test:e2e:debug

# Ou pour un test sp√©cifique
npx playwright test login.spec.ts --debug
```

#### Mode headless vs headed
```bash
# Voir le navigateur pendant les tests
npm run test:e2e:headed

# Mode normal (headless)
npm run test:e2e
```

#### UI Mode (interface graphique)
```bash
# Interface graphique pour explorer les tests
npm run test:e2e:ui
```

### 2. Screenshots et Traces

#### Screenshots automatiques
```typescript
test('example with screenshot', async ({ page }) => {
  await page.goto('/dashboard');
  
  // Screenshot manuel √† un moment pr√©cis
  await page.screenshot({ path: 'dashboard-state.png' });
  
  // Les screenshots d'√©chec sont automatiques avec votre config
});
```

#### Traces pour debug
```typescript
// playwright.config.ts
use: {
  trace: 'on-first-retry', // Trace seulement en cas d'√©chec
  // ou
  trace: 'on', // Trace pour tous les tests (plus lourd)
}
```

#### Voir les traces apr√®s √©chec
```bash
npm run test:e2e:report
# Cliquer sur un test √©chou√© pour voir la trace compl√®te
```

### 3. Gestion des Tests Flaky

#### Retry strategy
```typescript
// playwright.config.ts
export default defineConfig({
  retries: process.env.CI ? 3 : 1, // Plus de retries en CI
});

// Retry pour un test sp√©cifique
test('flaky test', async ({ page }) => {
  // ... test
});
test.describe.configure({ retries: 3 });
```

#### Timeouts personnalis√©s
```typescript
test('slow operation', async ({ page }) => {
  // Timeout sp√©cifique pour ce test
  test.setTimeout(60000); // 60 secondes
  
  // Timeout pour une action sp√©cifique
  await expect(page.locator('[data-testid="result"]')).toBeVisible({ timeout: 30000 });
});
```

#### Attentes plus robustes
```typescript
// ‚ùå Fragile
await page.waitForTimeout(5000);

// ‚úÖ Robuste
await page.waitForResponse('**/api/cv/generate');
await expect(page.locator('[data-testid="success"]')).toBeVisible();
```

---

## CI/CD et Automatisation ‚öôÔ∏è

### 1. GitHub Actions

Cr√©ez `.github/workflows/e2e-tests.yml` :

```yaml
name: E2E Tests

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]

jobs:
  e2e-tests:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v3
    
    - name: Setup Node.js
      uses: actions/setup-node@v3
      with:
        node-version: '18'
        cache: 'npm'
    
    - name: Install dependencies
      run: npm ci
    
    - name: Install Playwright browsers
      run: npx playwright install --with-deps
    
    - name: Setup test environment
      run: |
        cp .env.example .env.local
        echo "GEMINI_API_KEY=${{ secrets.GEMINI_API_KEY }}" >> .env.local
    
    - name: Run E2E tests
      run: npm run test:e2e
      env:
        CI: true
    
    - name: Upload test results
      uses: actions/upload-artifact@v3
      if: failure()
      with:
        name: playwright-report
        path: playwright-report/
```

### 2. Tests par environnement

```typescript
// tests/e2e/config/environments.ts
export const environments = {
  development: {
    baseURL: 'http://localhost:3000',
    user: { email: 'dev@example.com', password: 'devpass' }
  },
  staging: {
    baseURL: 'https://staging.cv-genius.com',
    user: { email: 'staging@example.com', password: 'stagingpass' }
  },
  production: {
    baseURL: 'https://cv-genius.com',
    user: { email: 'prod@example.com', password: 'prodpass' }
  }
};

// playwright.config.ts
const environment = process.env.TEST_ENV || 'development';
const config = environments[environment];

export default defineConfig({
  use: {
    baseURL: config.baseURL,
  },
});
```

### 3. Rapports et m√©triques

#### Reporter personnalis√©
```typescript
// playwright.config.ts
export default defineConfig({
  reporter: [
    ['html'], // Rapport HTML local
    ['github'], // Annotations GitHub (en CI)
    ['junit', { outputFile: 'test-results/junit.xml' }], // Pour CI/CD
  ],
});
```

#### M√©triques de performance
```typescript
test('performance check', async ({ page }) => {
  const startTime = Date.now();
  
  await page.goto('/dashboard');
  await expect(page.locator('h1')).toBeVisible();
  
  const loadTime = Date.now() - startTime;
  
  // V√©rifier que la page se charge en moins de 3 secondes
  expect(loadTime).toBeLessThan(3000);
});
```

---

## R√©sum√© et Prochaines √âtapes üéØ

### Ce que vous avez appris

1. **Concepts E2E** : Diff√©rence avec tests unitaires/int√©gration
2. **Playwright** : Configuration, locators, actions, assertions
3. **Page Object Model** : Organisation et maintenabilit√©
4. **Tests pratiques** : Login, CV workflow, navigation
5. **Debug et maintenance** : Outils, traces, tests flaky
6. **CI/CD** : Automatisation et d√©ploiement

### Checklist pour commencer

- [ ] ‚úÖ Configuration Playwright (d√©j√† fait)
- [ ] üìÅ Cr√©er la structure `tests/e2e/`
- [ ] üè∑Ô∏è Ajouter des `data-testid` aux composants critiques
- [ ] üìù √âcrire le premier test (login)
- [ ] üöÄ Lancer et d√©bugger
- [ ] üìä Int√©grer dans CI/CD

### Tests prioritaires √† impl√©menter

1. **Critique** : Login, registration, CV generation
2. **Important** : Navigation, file upload, error handling
3. **Nice-to-have** : Mobile responsiveness, performance

### Resources suppl√©mentaires

- [Documentation Playwright](https://playwright.dev/)
- [Best Practices Playwright](https://playwright.dev/docs/best-practices)
- [Page Object Model](https://playwright.dev/docs/test-pom)

Vous √™tes maintenant pr√™t √† cr√©er des tests E2E robustes pour CV-Genius ! üöÄ 